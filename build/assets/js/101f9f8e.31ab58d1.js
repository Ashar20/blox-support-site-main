"use strict";(self.webpackChunkionic_docs=self.webpackChunkionic_docs||[]).push([[66909],{58215:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},26396:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(87462),r=n(67294),i=n(72389),l=n(79443);var o=function(){var e=(0,r.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(89521),u=n(86010),p="tabItem_1uMI";function c(e){var t,n,a,i=e.lazy,l=e.block,c=e.defaultValue,d=e.values,h=e.groupId,m=e.className,k=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=d?d:k.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),v=(0,s.lx)(g,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var f=null===c?c:null!=(t=null!=c?c:null==(n=k.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=k[0])?void 0:a.props.value;if(null!==f&&!g.some((function(e){return e.value===f})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+f+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=o(),y=N.tabGroupChoices,b=N.setTabGroupChoices,w=(0,r.useState)(f),P=w[0],C=w[1],I=[],A=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var E=y[h];null!=E&&E!==P&&g.some((function(e){return e.value===E}))&&C(E)}var x=function(e){var t=e.currentTarget,n=I.indexOf(t),a=g[n].value;a!==P&&(A(t),C(a),null!=h&&b(h,a))},T=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=I.indexOf(e.currentTarget)+1;n=I[a]||I[0];break;case"ArrowLeft":var r=I.indexOf(e.currentTarget)-1;n=I[r]||I[I.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":l},m)},g.map((function(e){var t=e.value,n=e.label;return r.createElement("li",{role:"tab",tabIndex:P===t?0:-1,"aria-selected":P===t,className:(0,u.Z)("tabs__item",p,{"tabs__item--active":P===t}),key:t,ref:function(e){return I.push(e)},onKeyDown:T,onFocus:x,onClick:x},null!=n?n:t)}))),i?(0,r.cloneElement)(k.filter((function(e){return e.props.value===P}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},k.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==P})}))))}function d(e){var t=(0,i.Z)();return r.createElement(c,(0,a.Z)({key:String(t)},e))}},47758:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(67294),r=n(86010),i=n(39960),l=n(44996),o="card_3DNo";var s=function(e){var t,n=void 0===e.href,s=void 0!==e.href&&/^http/.test(e.href),u="undefined"===e.header?null:a.createElement("header",{className:"Card-header"},e.header),p=e.hoverIcon||e.icon,c=a.createElement(a.Fragment,null,e.img&&a.createElement("img",{src:(0,l.Z)(e.img),className:"Card-image"}),a.createElement("div",{className:"Card-container"},(e.icon||p)&&a.createElement("div",{className:"Card-icon-row"},e.icon&&a.createElement("img",{src:(0,l.Z)(e.icon),className:"Card-icon Card-icon-default"}),p&&a.createElement("img",{src:(0,l.Z)(p),className:"Card-icon Card-icon-hover"})),e.ionicon&&a.createElement("ion-icon",{name:e.ionicon,className:"Card-ionicon"}),e.iconset&&a.createElement("div",{className:"Card-iconset__container"},e.iconset.split(",").map((function(t,n){return a.createElement("img",{src:(0,l.Z)(t),className:"Card-icon "+(n===e.activeIndex?"Card-icon-active":""),"data-index":n,key:n})}))),e.header&&u,a.createElement("div",{className:"Card-content"},e.children))),d=(0,r.Z)(((t={"Card-with-image":void 0!==e.img,"Card-without-image":void 0===e.img,"Card-size-lg":"lg"===e.size})[e.className]=e.className,t));return n?a.createElement("docs-card",{class:d},a.createElement("div",{className:(0,r.Z)(o,"docs-card")},c)):s?a.createElement("docs-card",{class:d},a.createElement("a",{className:(0,r.Z)(o,"docs-card"),href:e.href,target:"_blank"},c)):a.createElement("docs-card",{class:d},a.createElement(i.default,{to:e.href,className:(0,r.Z)(o,"docs-card")},c))}},88694:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(87462),r=n(63366),i=n(86010),l=n(67294),o="docsButton_2gXP",s="docsButtonRound_2y-L",u=["href","round"];function p(e){var t,n=e.href,p=e.round,c=void 0!==p&&p,d=(0,r.Z)(e,u);return d.className=(0,i.Z)(((t={})[d.className]=Boolean(d.className),t[o]=!0,t["docs-button"]=!0,t[s]=c,t["docs-button--round"]=c,t)),n?l.createElement("a",(0,a.Z)({href:n,className:"docsButton"},d),d.children):l.createElement("button",(0,a.Z)({className:"docsButton"},d),d.children)}},17811:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return h},metadata:function(){return m},toc:function(){return k},default:function(){return v}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),l=n(47758),o=n(88694),s=n(26396),u=n(58215),p=n(19055),c=["components"],d={title:"In App Purchase 2"},h=void 0,m={unversionedId:"native/in-app-purchase-2",id:"native/in-app-purchase-2",isDocsHomePage:!1,title:"In App Purchase 2",description:"In-App Purchase (IAP) 2: iOS, Android, Windows, macOS & Xbox Apps",source:"@site/docs/native/in-app-purchase-2.md",sourceDirName:"native",slug:"/native/in-app-purchase-2",permalink:"/developer/docs/native/in-app-purchase-2",editUrl:"https://github.com/ionic-team/ionic-native/edit/master/src/@awesome-cordova-plugins/plugins/in-app-purchase-2/index.ts",tags:[],version:"current",frontMatter:{title:"In App Purchase 2"},sidebar:"native",previous:{title:"In App Browser",permalink:"/developer/docs/native/in-app-browser"},next:{title:"In App Review",permalink:"/developer/docs/native/in-app-review"}},k=[{value:"Features",id:"features",children:[],level:2},{value:"Supported Platforms",id:"supported-platforms",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"React",id:"react",children:[],level:3},{value:"Angular",id:"angular",children:[],level:3}],level:2},{value:"Full example",id:"full-example",children:[],level:2},{value:"Philosophy",id:"philosophy",children:[],level:2},{value:"Registering products",id:"registering-products",children:[],level:2},{value:"Displaying products",id:"displaying-products",children:[],level:2},{value:"Purchasing",id:"purchasing",children:[{value:"initiate a purchase",id:"initiate-a-purchase",children:[],level:4},{value:"finish a purchase",id:"finish-a-purchase",children:[],level:4},{value:"example usage",id:"example-usage",children:[],level:4},{value:"un-finished purchases",id:"un-finished-purchases",children:[],level:4},{value:"simple case",id:"simple-case",children:[],level:4}],level:2},{value:"Receipt validation",id:"receipt-validation",children:[{value:"example using a validation URL",id:"example-using-a-validation-url",children:[],level:4}],level:2},{value:"Subscriptions",id:"subscriptions",children:[],level:2},{value:"Product life-cycle",id:"product-life-cycle",children:[],level:2}],g={toc:k};function v(e){var t=e.components,n=(0,r.Z)(e,c);return(0,i.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("head",null,(0,i.kt)("title",null,"In-App Purchase (IAP) 2: iOS, Android, Windows, macOS & Xbox Apps"),(0,i.kt)("meta",{name:"description",content:"In-App Purchase 2 lets users make purchases directly from iOS, Android, Windows, macOS, and Xbox devices. Read to learn more about Ionic apps and IAP usage."})),(0,i.kt)("p",null,"In-App Purchase on iOS, Android, Windows, macOS and XBox."),(0,i.kt)("h2",{id:"features"},"Features"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null},"ios"),(0,i.kt)("th",{parentName:"tr",align:null},"android"),(0,i.kt)("th",{parentName:"tr",align:null},"win-8"),(0,i.kt)("th",{parentName:"tr",align:null},"win-10/uwp"),(0,i.kt)("th",{parentName:"tr",align:null},"mac"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"consumables"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"non consumables"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"subscriptions"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"restore purchases"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"receipt validations"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"downloadable content"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"introductory prices"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,i.kt)("p",null,"Supports:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"iOS")," version 7.0 or higher."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Android")," version 2.2 (API level 8) or higher",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"with Google Play client version 3.9.16 or higher"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Windows")," Store/Phone 8.1 or higher"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Windows 10 Mobile")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"macOS")," version 10"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Xbox One"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"(and any platform supporting Microsoft's UWP)")))),(0,i.kt)("p",null,(0,i.kt)("a",{href:"https://github.com/j3k0/cordova-plugin-purchase",target:"_blank",rel:"noopener",className:"git-link"},(0,i.kt)("svg",{viewBox:"0 0 512 512"},(0,i.kt)("path",{d:"M416 160c0-35.3-28.7-64-64-64s-64 28.7-64 64c0 23.7 12.9 44.3 32 55.4v8.6c0 19.9-7.8 33.7-25.3 44.9-15.4 9.8-38.1 17.1-67.5 21.5-14 2.1-25.7 6-35.2 10.7V151.4c19.1-11.1 32-31.7 32-55.4 0-35.3-28.7-64-64-64S96 60.7 96 96c0 23.7 12.9 44.3 32 55.4v209.2c-19.1 11.1-32 31.7-32 55.4 0 35.3 28.7 64 64 64s64-28.7 64-64c0-16.6-6.3-31.7-16.7-43.1 1.9-4.9 9.7-16.3 29.4-19.3 38.8-5.8 68.9-15.9 92.3-30.8 36-22.8 55-57 55-98.8v-8.6c19.1-11.1 32-31.7 32-55.4zM160 56c22.1 0 40 17.9 40 40s-17.9 40-40 40-40-17.9-40-40 17.9-40 40-40zm0 400c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zm192-256c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40z"}))," https://github.com/j3k0/cordova-plugin-purchase")),(0,i.kt)("h2",null,"Stuck on a Cordova issue?"),(0,i.kt)(l.Z,{className:"cordova-ee-card",header:"Don't waste precious time on plugin issues.",href:"https://ionicframework.com/sales?product_of_interest=Ionic%20Native",mdxType:"DocsCard"},(0,i.kt)("div",null,(0,i.kt)("img",{src:"/docs/icons/native-cordova-bot.png",class:"cordova-ee-img"}),(0,i.kt)("p",null,"If you're building a serious project, you can't afford to spend hours troubleshooting. Ionic\u2019s experts offer premium advisory services for both community plugins and premier plugins."),(0,i.kt)(o.Z,{className:"native-ee-detail",mdxType:"DocsButton"},"Contact Us Today!"))),(0,i.kt)("h2",{id:"installation"},(0,i.kt)("a",{href:"#installation"},"Installation")),(0,i.kt)(s.Z,{defaultValue:"Capacitor",groupId:"runtime",values:[{value:"Capacitor",label:"Capacitor"},{value:"Cordova",label:"Cordova"},{value:"Enterprise",label:"Enterprise"}],mdxType:"Tabs"},(0,i.kt)(u.Z,{value:"Capacitor",mdxType:"TabItem"},(0,i.kt)(p.Z,{className:"language-shell",mdxType:"CodeBlock"},"$ npm install cordova-plugin-purchase ","\n","$ npm install @awesome-cordova-plugins/in-app-purchase-2 ","\n","$ ionic cap sync")),(0,i.kt)(u.Z,{value:"Cordova",mdxType:"TabItem"},(0,i.kt)(p.Z,{className:"language-shell",mdxType:"CodeBlock"},"$ ionic cordova plugin add cordova-plugin-purchase ","\n","$ npm install @awesome-cordova-plugins/in-app-purchase-2 ","\n")),(0,i.kt)(u.Z,{value:"Enterprise",mdxType:"TabItem"},(0,i.kt)("blockquote",null,"Ionic Enterprise comes with fully supported and maintained plugins from the Ionic Team. \xa0",(0,i.kt)("a",{class:"btn",href:"https://ionic.io/docs/premier-plugins"},"Learn More")," or if you're interested in an enterprise version of this plugin ",(0,i.kt)("a",{class:"btn",href:"https://ionicframework.com/sales?product_of_interest=Ionic%20Enterprise%20Engine"},"Contact Us")))),(0,i.kt)("h2",{id:"supported-platforms"},"Supported Platforms"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"iOS"),(0,i.kt)("li",{parentName:"ul"},"Android"),(0,i.kt)("li",{parentName:"ul"},"Windows")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"react"},"React"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/developer/docs/native/community#react"},"Learn more about using Ionic Native components in React")),(0,i.kt)("h3",{id:"angular"},"Angular"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import { InAppPurchase2 } from \'@awesome-cordova-plugins/in-app-purchase-2/ngx\';\n\nconstructor(public platform: Platform, private store: InAppPurchase2) {\n  platform.ready().then(() => {\n   this.store.register({\n     id: "my_product_id",\n     type: this.store.NON_RENEWING_SUBSCRIPTION,\n   });\n   this.store.when("my_product_id")\n     .approved(p => p.verify())\n     .verified(p => p.finish());\n   this.store.refresh();\n  });\n}\n\n...\n\nthis.store.order("my_product_id");\n\n')),(0,i.kt)("h2",{id:"full-example"},"Full example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"}," // After platform ready\n this.store.verbosity = this.store.DEBUG;\n this.store.register({\n   id: \"my_product_id\",\n   type: this.store.PAID_SUBSCRIPTION,\n });\n\n // Register event handlers for the specific product\n this.store.when(\"my_product_id\").registered( (product: IAPProduct) => {\n   console.log('Registered: ' + JSON.stringify(product));\n });\n\n // Updated\n this.store.when(\"my_product_id\").updated( (product: IAPProduct) => {\n   console.log('Updated' + JSON.stringify(product));\n });\n\n // User closed the native purchase dialog\n this.store.when(\"my_product_id\").cancelled( (product) => {\n     console.error('Purchase was Cancelled');\n });\n\n // Track all store errors\n this.store.error( (err) => {\n   console.error('Store Error ' + JSON.stringify(err));\n });\n\n // Run some code only when the store is ready to be used\n this.store.ready(() =>  {\n   console.log('Store is ready');\n   console.log('Products: ' + JSON.stringify(this.store.products));\n   console.log(JSON.stringify(this.store.get(\"my_product_id\")));\n });\n\n // Refresh the status of in-app products\n this.store.refresh();\n\n ...\n\n // To make a purchase\n this.store.order(\"my_product_id\");\n\n")),(0,i.kt)("h2",{id:"philosophy"},"Philosophy"),(0,i.kt)("p",null,"The API is mostly events based. As a user of this plugin,\nyou will have to register listeners to changes happening to the products\nyou register."),(0,i.kt)("p",null,"The core of the listening mechanism is the ",(0,i.kt)("inlineCode",{parentName:"p"},"when()")," method. It allows you to\nbe notified of changes to one or a set of products using a query mechanism:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},' this.store.when("product").updated(refreshScreen); // match any product\n this.store.when("full_version").owned(unlockApp); // match a specific product\n this.store.when("subscription").approved(serverCheck); // match all subscriptions\n this.store.when("downloadable content").downloaded(showContent);\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"updated")," event is fired whenever one of the fields of a product is\nchanged (its ",(0,i.kt)("inlineCode",{parentName:"p"},"owned")," status for instance)."),(0,i.kt)("p",null,"This event provides a generic way to track the statuses of your purchases,\nto unlock features when needed and to refresh your views accordingly."),(0,i.kt)("h2",{id:"registering-products"},"Registering products"),(0,i.kt)("p",null,"The store needs to know the type and identifiers of your products before you\ncan use them in your code."),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"store.register()")," to define them before your first call to ",(0,i.kt)("inlineCode",{parentName:"p"},"store.refresh()"),"."),(0,i.kt)("p",null,"Once registered, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"store.get()")," to retrieve an ",(0,i.kt)("inlineCode",{parentName:"p"},"IAPProduct")," object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},' this.store.register({\n   id: "my_consumable1",\n   type: this.store.CONSUMABLE\n });\n ...\n const p = this.store.get("my_consumable1");\n')),(0,i.kt)("p",null,"The product ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," have to match products defined in your\nApple, Google or Microsoft developer consoles."),(0,i.kt)("p",null,"Learn more about it ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/j3k0/cordova-plugin-purchase/wiki"},"from the wiki"),"."),(0,i.kt)("h2",{id:"displaying-products"},"Displaying products"),(0,i.kt)("p",null,"Right after you registered your products, nothing much is known about them\nexcept their ",(0,i.kt)("inlineCode",{parentName:"p"},"id"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," and an optional ",(0,i.kt)("inlineCode",{parentName:"p"},"alias"),"."),(0,i.kt)("p",null,"When you perform the initial call to ",(0,i.kt)("inlineCode",{parentName:"p"},"store.refresh()"),", the platforms' server will\nbe contacted to load informations about the registered products: human\nreadable ",(0,i.kt)("inlineCode",{parentName:"p"},"title")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"description"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"price"),", etc."),(0,i.kt)("p",null,"This isn't an optional step, store owners require you\nto display information about a product exactly as retrieved from their server: no\nhard-coding of price and title allowed! This is also convenient for you\nas you can change the price of your items knowing that it'll be reflected instantly\non your clients' devices."),(0,i.kt)("p",null,"Note that the information may not be available when the first view that needs\nthem appears on screen. For you, the best option is to have your view monitor\nchanges made to the product."),(0,i.kt)("h2",{id:"purchasing"},"Purchasing"),(0,i.kt)("h4",{id:"initiate-a-purchase"},"initiate a purchase"),(0,i.kt)("p",null,"Purchases are initiated using the ",(0,i.kt)("inlineCode",{parentName:"p"},'store.order("some_product_id")')," method."),(0,i.kt)("p",null,"The store will manage the internal purchase flow. It'll end:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"with an ",(0,i.kt)("inlineCode",{parentName:"li"},"approved")," event. The product enters the ",(0,i.kt)("inlineCode",{parentName:"li"},"APPROVED")," state."),(0,i.kt)("li",{parentName:"ul"},"with a ",(0,i.kt)("inlineCode",{parentName:"li"},"cancelled")," event. The product gets back to the ",(0,i.kt)("inlineCode",{parentName:"li"},"VALID")," state."),(0,i.kt)("li",{parentName:"ul"},"with an ",(0,i.kt)("inlineCode",{parentName:"li"},"error")," event. The product gets back to the ",(0,i.kt)("inlineCode",{parentName:"li"},"VALID")," state.")),(0,i.kt)("p",null,"See the product life-cycle section for details about product states."),(0,i.kt)("h4",{id:"finish-a-purchase"},"finish a purchase"),(0,i.kt)("p",null,"Once the transaction is approved, the product still isn't owned: the store needs\nconfirmation that the purchase was delivered before closing the transaction."),(0,i.kt)("p",null,"To confirm delivery, you'll use the ",(0,i.kt)("inlineCode",{parentName:"p"},"product.finish()")," method."),(0,i.kt)("h4",{id:"example-usage"},"example usage"),(0,i.kt)("p",null,"During initialization:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'this.store.when("extra_chapter").approved((product: IAPProduct) => {\n  // download the feature\n  app.downloadExtraChapter()\n  .then(() => product.finish());\n});\n')),(0,i.kt)("p",null,"When the purchase button is clicked:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'this.store.order("extra_chapter");\n')),(0,i.kt)("h4",{id:"un-finished-purchases"},"un-finished purchases"),(0,i.kt)("p",null,"If your app wasn't able to deliver the content, ",(0,i.kt)("inlineCode",{parentName:"p"},"product.finish()")," won't be called."),(0,i.kt)("p",null,"Don't worry: the ",(0,i.kt)("inlineCode",{parentName:"p"},"approved")," event will be re-triggered the next time you\ncall ",(0,i.kt)("inlineCode",{parentName:"p"},"store.refresh()"),", which can very well be the next time\nthe application starts. Pending transactions are persistant."),(0,i.kt)("h4",{id:"simple-case"},"simple case"),(0,i.kt)("p",null,"In the most simple case, where:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"delivery of purchases is only local ;"),(0,i.kt)("li",{parentName:"ul"},"you don't want (or need) to implement receipt validation ;")),(0,i.kt)("p",null,"You may just want to finish all purchases automatically. You can do it this way:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'this.store.when("product").approved((p: IAPProduct) => p.finish());\n')),(0,i.kt)("p",null,'NOTE: the "product" query will match any purchases (see "queries" to learn more details about queries).'),(0,i.kt)("h2",{id:"receipt-validation"},"Receipt validation"),(0,i.kt)("p",null,"To get the most up-to-date information about purchases (in case a purchase have been canceled, or a subscription renewed),\nyou should implement server side receipt validation."),(0,i.kt)("p",null,'This also protects you against fake "purchases", made by some users using\n"free in-app purchase" apps on their devices.'),(0,i.kt)("p",null,"When a purchase has been approved by the store, it's enriched with\ntransaction information (see ",(0,i.kt)("inlineCode",{parentName:"p"},"product.transaction")," attribute)."),(0,i.kt)("p",null,"To verify a purchase you'll have to do three things:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"configure the validator."),(0,i.kt)("li",{parentName:"ul"},"call ",(0,i.kt)("inlineCode",{parentName:"li"},"product.verify()")," from the ",(0,i.kt)("inlineCode",{parentName:"li"},"approved")," event, before finishing the transaction."),(0,i.kt)("li",{parentName:"ul"},"finish the transaction when transaction is ",(0,i.kt)("inlineCode",{parentName:"li"},"verified"),".")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Shameless Plug"),": this is a feature many users struggle with, so as the author of this plugin, we can provide it to you as-a-service: ",(0,i.kt)("a",{parentName:"p",href:"https://billing.fovea.cc/"},"https://billing.fovea.cc/"),"\n(which is free until you start making serious money)"),(0,i.kt)("h4",{id:"example-using-a-validation-url"},"example using a validation URL"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'this.store.validator = "https://billing.fovea.cc/";\n\nthis.store.when("my stuff")\n  .approved((p: IAPProduct) => p.verify())\n  .verified((p: IAPProduct) => p.finish());\n')),(0,i.kt)("h2",{id:"subscriptions"},"Subscriptions"),(0,i.kt)("p",null,"For subscription, you MUST implement remote receipt validation."),(0,i.kt)("p",null,"When the receipt validator returns a ",(0,i.kt)("inlineCode",{parentName:"p"},"store.PURCHASE_EXPIRED")," error code, the subscription will\nautomatically loose its ",(0,i.kt)("inlineCode",{parentName:"p"},"owned")," status."),(0,i.kt)("p",null,"Typically, you'll enable and disable access to your content this way."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'this.store.when("my_subcription").updated((product: IAPProduct) => {\n  if (product.owned)\n    app.subscriberMode();\n  else\n    app.guestMode();\n});\n')),(0,i.kt)("h2",{id:"product-life-cycle"},"Product life-cycle"),(0,i.kt)("p",null,"A product will change state during the application execution."),(0,i.kt)("p",null,"Find below a diagram of the different states a product can pass by."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"REGISTERED +--\x3e INVALID\n           |\n           +--\x3e VALID +--\x3e REQUESTED +--\x3e INITIATED +-+\n                                                      |\n                ^      +------------------------------+\n                |      |\n                |      |             +--\x3e DOWNLOADING +--\x3e DOWNLOADED +\n                |      |             |                                |\n                |      +--\x3e APPROVED +--------------------------------+--\x3e FINISHED +--\x3e OWNED\n                |                                                             |\n                +-------------------------------------------------------------+\n\n#### Notes\n\n - When finished, a consumable product will get back to the `VALID` state, while other will enter the `OWNED` state.\n - Any error in the purchase process will bring a product back to the `VALID` state.\n - During application startup, products may go instantly from `REGISTERED` to `APPROVED` or `OWNED`, for example if they are purchased non-consumables or non-expired subscriptions.\n - Non-Renewing Subscriptions are iOS products only. Please see the [iOS Non Renewing Subscriptions documentation](https://github.com/j3k0/cordova-plugin-purchase/blob/master/doc/ios.md#non-renewing) for a detailed explanation.\n\n## events\n\n - `loaded(IAPProduct)`\n   - Called when product data is loaded from the store.\n - `updated(IAPProduct)`\n   - Called when any change occured to a product.\n - `error(err)`\n   - Called when an order failed.\n   - The `err` parameter is an error object\n - `approved(IAPProduct)`\n   - Called when a product order is approved.\n - `owned(IAPProduct)`\n   - Called when a non-consumable product or subscription is owned.\n - `cancelled(IAPProduct)`\n   - Called when a product order is cancelled by the user.\n - `refunded(IAPProduct)`\n   - Called when an order is refunded by the user.\n - Actually, all other product states have their promise\n   - `registered`, `valid`, `invalid`, `requested`,\n     `initiated` and `finished`\n - `verified(IAPProduct)`\n   - Called when receipt validation successful\n - `unverified(IAPProduct)`\n   - Called when receipt verification failed\n - `expired(IAPProduct)`\n   - Called when validation find a subscription to be expired\n - `downloading(IAPProduct, progress, time_remaining)`\n   - Called when content download is started\n - `downloaded(IAPProduct)`\n   - Called when content download has successfully completed\n\n## Learn More\n\n - [GitHub](https://github.com/j3k0/cordova-plugin-purchase)\n - [GitBook](https://purchase.cordova.fovea.cc/)\n - [Wiki](https://github.com/j3k0/cordova-plugin-purchase/wiki)\n - [API reference](https://github.com/j3k0/cordova-plugin-purchase/blob/master/doc/api.md)\n\n## Technical Support or Questions\n\nIf you have questions or need help integrating In-App Purchase, [Open an Issue on GitHub](https://github.com/j3k0/cordova-plugin-purchase/issues) or email us at _support@fovea.cc_.\n\n@interfaces\nIAPProduct\nIAPProductOptions\nIAPProductEvents\n")))}v.isMDXComponent=!0}}]);